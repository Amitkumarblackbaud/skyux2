<sky-demo-nav></sky-demo-nav>

<stache pageTitle="Component libraries" showTableOfContents="true">
  <stache-page-summary>
    This page documents how to create a reusable component library for SKY UX.
  </stache-page-summary>

  <stache-page-anchor>
    Overview
  </stache-page-anchor>

  <stache-page-anchor>
    Installing dependencies
  </stache-page-anchor>

  <p>
    - The following command will create a new SKY UX SPA with features that will help you author a component library.
    - Clones a template with a starter module.
  </p>

  <stache-code-block>
    skyux new --template library
  </stache-code-block>

  <stache-page-anchor>
    Creating the library
  </stache-page-anchor>

  <p>
    The library source files live in <strong>/src/app/public</strong>. This folder is special in that SKY UX Builder will ignore components saved here (ie, the components will not be automatically declared in the <stache-code>SkyModule</stache-code>). This will allow you to write Angular modules, components, and services outside of SKY UX's scope.
  </p>

  <p>
    The entry point for your component library is <strong>/src/app/public/index.ts</strong>. This file is responsible for exporting any code you want to be made available to the bundler.
  </p>

  <stache-page-anchor>
    Building your library
  </stache-page-anchor>

  <stache-code-block>
    skyux build-public-library
  </stache-code-block>

  <sky-alert [alertType]="'info'">
    Please note that this CLI command only bundles the files into a <strong>/dist</strong> directory. You are responsible for choosing the publishing method (see below).
  </sky-alert>

  <stache-page-anchor>
    Publishing your library
  </stache-page-anchor>

  <p>
    (Add notes here about NPM feeds for both public and private libraries.)
  </p>

  <h3>
    Method 1: Publishing to Blackbaud's NPM stream (internal-only)
  </h3>

  <p>
    For internal-only component libraries, you'll need to register your SPA through the appropriate VSTS pipeline. Reach out to Jonathan Bell for more information.
  </p>

  <h3>
    Method 2: Publishing to npmjs.org (public)
  </h3>

  <p>
    Publishing to npmjs.org is done via Travis-CI, and free GitHub continuous integration service. If you wish to publish your library in the <stache-code>@blackbaud/*</stache-code> namespace, reach out to someone on the SKY UX team to get the Travis-CI account created and setup. Otherwise, you'll need to write some custom commands to have Travis-CI automatically publish your bundle to npmjs.org (See <a href="https://docs.travis-ci.com/user/deployment/npm/">Releasing to NPM with Travis-CI</a>, for more information).
  </p>

  <stache-page-anchor>
    Consuming your library in another SPA
  </stache-page-anchor>

  <p>
    <strong>/app/src/app-extras.module.ts</strong>
  </p>
  <stache-code-block languageType="typescript">
    import { NgModule } from '@angular/core';

    import { LibraryModule } from 'my-component-library';

    @NgModule({
      imports: [
        LibraryModule
      ],
      exports: [
        LibraryModule
      ]
    })
    export class AppExtrasModule { }
  </stache-code-block>

  <stache-page-anchor>
    Accessing the consuming app's configuration
  </stache-page-anchor>

  <p>
    (Provide reasons for why SkyAppConfig cannot be accessed by the component library. Why we need to create the adaptor, etc.)
  </p>
  <p>
    Since the source files found in <strong>@blackbaud/skyux-builder/runtime</strong> (such as <stache-code>SkyAppConfig</stache-code>) are not transpiled as a <a href="http://davidbcalhoun.com/2014/what-is-amd-commonjs-and-umd/">UMD module</a>--and thus cannot be <a href="https://www.npmjs.com/package/codelyzer">analyzed statically</a>--we cannot directly reference these files in our component library (since it will eventually become a UMD module). Instead, we must create an adaptor class (in the consuming SPA) that can be provided the transpiled version of <stache-code>SkyAppConfig</stache-code> at runtime.
  </p>

  <p>
    The following code sample demonstrates how to create the adaptor in the consuming SPA.
  </p>

  <p>
    <strong>/app/src/app-extras.module.ts</strong>
  </p>

  <stache-code-block languageType="typescript">
    import { NgModule } from '@angular/core';

    import { SkyAppConfig } from '@blackbaud/skyux-builder/runtime';

    import { LibraryModule, LibraryConfigService } from 'my-component-library';

    @NgModule({
      imports: [
        LibraryModule
      ],
      exports: [
        LibraryModule
      ],
      providers: [
        // The config service acts as an adaptor for skyuxconfig.json:
        {
          provide: LibraryConfigService,
          useExisting: SkyAppConfig
        }
      ]
    })
    export class AppExtrasModule { }
  </stache-code-block>

  <stache-page-anchor>
    Providing configuration for your library
  </stache-page-anchor>

  <p>
    (This step depends on the previous step.)
  </p>

  <p>
    Add any properties you wish to <stache-code>"appSettings"</stache-code>.
  </p>

  <p>
    <strong>/skyuxconfig.json</strong>
  </p>

  <stache-code-block languageType="json">
    {
      "appSettings": {
        "myLibrary": {
          "foo": "bar",
          "baz": true
        }
      }
    }
  </stache-code-block>

  <p>
    You may then access these properties in your components by injecting the  <stache-code>LibraryConfigService</stache-code>.
  </p>

  <p>
    <strong>/app/src/public/src/modules/shared/config.service.ts</strong>
  </p>

  <stache-code-block languageType="typescript">
    import { LibraryConfigService } from '../shared';

    @Component({ ... })
    export class MyLibraryComponent {
      constructor(public configService: LibraryConfigService) {
        console.log(configService.appSettings.myLibrary.foo); // "bar"
      }
    }

  </stache-code-block>
</stache>
